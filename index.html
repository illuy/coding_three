<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coding_three</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="team.css">
    <link rel="stylesheet" href="member.css">
    <link rel="stylesheet" href="board.css">
</head>

<body>
    <main>
        <header>
            <nav class="main_nav">
                <div class="sun">
                    <img class="sun01" src="./image/sun_01.png" alt="">
                    <img class="sun02" src="./image/sun_02.png" alt="">
                </div>
                <ul>
                    <li class="show"><a href="#HOME">HOME</a></li>
                    <li><a href="#TEAM">TEAM</a></li>
                    <li><a href="#MEMBER">MEMBER</a></li>
                    <li><a href="#BOARD">BOARD</a></li>
                </ul>
            </nav>
        </header>
        <section id="HOME">
            <div class="title">
                <h2>coding three</h2>
                <h5>코딩 꿈나무들의 React 정복</h5>
            </div>
            <div class="home_member_img">
                <article><img src="./image/intro_member01.png" alt="화분1번"><span></span></article>
                <article><img src="./image/intro_member02.png" alt="화분2번"><span></span></article>
                <article><img src="./image/intro_member03.png" alt="화분3번"><span></span></article>
                <article><img src="./image/intro_member04.png" alt="화분4번"><span></span></article>
                <article><img src="./image/intro_member05.png" alt="화분5번"><span></span></article>
                <article><img src="./image/intro_member06.png" alt="화분6번"><span></span></article>
            </div>
            <div class="sprout">
                <img src="./image/sprout.png" alt="">
                <img src="./image/sprout.png" alt="">
                <img src="./image/sprout.png" alt="">
                <img src="./image/sprout.png" alt="">
                <img src="./image/sprout.png" alt="">
                <img src="./image/sprout.png" alt="">
                <img src="./image/sprout.png" alt="">
            </div>
        </section>
        <section id="TEAM">
            <div class="title">
                <h1>CODING T<span id="h">h</span>REE</h1>
                <h5>코딩 꿈나무들의 REACT 정복</h5>
            </div>
            <div id="grid_hz">
                <div id="grid_vt">
                    <div id="line"></div>
                    <div class="text_cont">
                        <h3>우리 팀만의 특징과 궁극적인 목표</h3>
                        <ul>
                            <li>HTML, CSS, JAVASCRIPT(REACT) 정복하기</li>
                            <li>GIT 활용 습관화 하기</li>
                        </ul>
                        <h3>우리 팀의 약속</h3>
                        <ul>
                            <li>모르는 것이 있을 때는 서로 물어보고 대답해 주기</li>
                            <li>지각하지 않고 특이 사항 발생 시 팀원에게 연락 주기</li>
                            <li>존중 친절 칭찬 배려</li>
                            <li>서로 블로그에 댓글 남겨주기</li>
                        </ul>
                    </div>
                </div>
                <div class="team_tree">
                    <article><img src="./image/team_tree.png" alt=""></article>
                </div>
            </div>

        </section>
        <section id="MEMBER">
            <div class="container">
                <div class="tab_cont">
                    <!-- <div class="on"> -->
                    <div class="grd_hz on">
                        <div style="margin: 50px 0 0 35px;">
                            <img src="https://health.chosun.com/site/data/img_dir/2023/07/17/2023071701753_0.jpg"
                                style="margin-right: 50px;">
                        </div>
                        <div>
                            <h1>고양이</h1>
                            <br>
                            <br>
                            <ol>
                                <li>mbti - istj</li>
                                <br>
                                <li>객관적으로 살펴본 자신의 장점
                                    <ul>
                                        <li>침착하다.</li>
                                        <li>객관화가 잘되어있다.</li>
                                    </ul>
                                </li>
                                <br>
                                <li>자신의 협업 스타일 소개
                                    <ul>
                                        <li>경청을 잘하는 스타일</li>
                                    </ul>
                                </li>
                                <br>
                                <li>블로그 주소 : https://velog.io/@illu_y</li>
                            </ol>
                        </div>
                    </div>
                    <!-- </div> -->
                    <div class="grd_hz">
                        <div style="margin: 50px 0 0 35px;">
                            <img src="https://health.chosun.com/site/data/img_dir/2023/07/17/2023071701753_0.jpg"
                                style="margin-right: 50px;">
                        </div>
                        <div>
                            <h1>토끼</h1>
                            <br>
                            <br>
                            <ol>
                                <li>mbti - istj</li>
                                <br>
                                <li>객관적으로 살펴본 자신의 장점
                                    <ul>
                                        <li>침착하다.</li>
                                        <li>객관화가 잘되어있다.</li>
                                    </ul>
                                </li>
                                <br>
                                <li>자신의 협업 스타일 소개
                                    <ul>
                                        <li>경청을 잘하는 스타일</li>
                                    </ul>
                                </li>
                                <br>
                                <li>블로그 주소 : https://velog.io/@illu_y</li>
                            </ol>
                        </div>
                    </div>
                    <div class="grd_hz">
                        <div style="margin: 50px 0 0 35px;">
                            <img src="https://health.chosun.com/site/data/img_dir/2023/07/17/2023071701753_0.jpg"
                                style="margin-right: 50px;">
                        </div>
                        <div>
                            <h1>강아지</h1>
                            <br>
                            <br>
                            <ol>
                                <li>mbti - istj</li>
                                <br>
                                <li>객관적으로 살펴본 자신의 장점
                                    <ul>
                                        <li>침착하다.</li>
                                        <li>객관화가 잘되어있다.</li>
                                    </ul>
                                </li>
                                <br>
                                <li>자신의 협업 스타일 소개
                                    <ul>
                                        <li>경청을 잘하는 스타일</li>
                                    </ul>
                                </li>
                                <br>
                                <li>블로그 주소 : https://velog.io/@illu_y</li>
                            </ol>
                        </div>
                    </div>
                    <div class="grd_hz">
                        <div style="margin: 50px 0 0 35px;">
                            <img src="https://health.chosun.com/site/data/img_dir/2023/07/17/2023071701753_0.jpg"
                                style="margin-right: 50px;">
                        </div>
                        <div>
                            <h1>늑대</h1>
                            <br>
                            <br>
                            <ol>
                                <li>mbti - istj</li>
                                <br>
                                <li>객관적으로 살펴본 자신의 장점
                                    <ul>
                                        <li>침착하다.</li>
                                        <li>객관화가 잘되어있다.</li>
                                    </ul>
                                </li>
                                <br>
                                <li>자신의 협업 스타일 소개
                                    <ul>
                                        <li>경청을 잘하는 스타일</li>
                                    </ul>
                                </li>
                                <br>
                                <li>블로그 주소 : https://velog.io/@illu_y</li>
                            </ol>
                        </div>
                    </div>
                    <div class="grd_hz">
                        <div style="margin: 50px 0 0 35px;">
                            <img src="https://health.chosun.com/site/data/img_dir/2023/07/17/2023071701753_0.jpg"
                                style="margin-right: 50px;">
                        </div>
                        <div>
                            <h1>곰</h1>
                            <br>
                            <br>
                            <ol>
                                <li>mbti - istj</li>
                                <br>
                                <li>객관적으로 살펴본 자신의 장점
                                    <ul>
                                        <li>침착하다.</li>
                                        <li>객관화가 잘되어있다.</li>
                                    </ul>
                                </li>
                                <br>
                                <li>자신의 협업 스타일 소개
                                    <ul>
                                        <li>경청을 잘하는 스타일</li>
                                    </ul>
                                </li>
                                <br>
                                <li>블로그 주소 : https://velog.io/@illu_y</li>
                            </ol>
                        </div>
                    </div>
                    <div class="grd_hz">
                        <div style="margin: 50px 0 0 35px;">
                            <img src="https://health.chosun.com/site/data/img_dir/2023/07/17/2023071701753_0.jpg"
                                style="margin-right: 50px;">
                        </div>
                        <div>
                            <h1>여우 </h1>
                            <br>
                            <br>
                            <ol>
                                <li>mbti - istj</li>
                                <br>
                                <li>객관적으로 살펴본 자신의 장점
                                    <ul>
                                        <li>침착하다.</li>
                                        <li>객관화가 잘되어있다.</li>
                                    </ul>
                                </li>
                                <br>
                                <li>자신의 협업 스타일 소개
                                    <ul>
                                        <li>경청을 잘하는 스타일</li>
                                    </ul>
                                </li>
                                <br>
                                <li>블로그 주소 : https://velog.io/@illu_y</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div>
                    <ul class="tab_title">
                        <li class="on"><img
                                src="https://w7.pngwing.com/pngs/384/868/png-transparent-person-profile-avatar-user-basic-ui-icon.png"
                                width="50px" style="padding-top : 30px;"></li>
                        <li><img src="https://w7.pngwing.com/pngs/384/868/png-transparent-person-profile-avatar-user-basic-ui-icon.png"
                                width="50px" style="padding-top : 30px;"></li>
                        <li><img src="https://w7.pngwing.com/pngs/384/868/png-transparent-person-profile-avatar-user-basic-ui-icon.png"
                                width="50px" style="padding-top : 30px;"></li>
                        <li><img src="https://w7.pngwing.com/pngs/384/868/png-transparent-person-profile-avatar-user-basic-ui-icon.png"
                                width="50px" style="padding-top : 30px;"></li>
                        <li><img src="https://w7.pngwing.com/pngs/384/868/png-transparent-person-profile-avatar-user-basic-ui-icon.png"
                                width="50px" style="padding-top : 30px;"></li>
                        <li><img src="https://w7.pngwing.com/pngs/384/868/png-transparent-person-profile-avatar-user-basic-ui-icon.png"
                                width="50px" style="padding-top : 30px;"></li>
                    </ul>
                </div>
            </div>
        </section>
        <section id="BOARD">
            <div class="write">
                <div class="wForm1">
                    <div class="wIconPview">
                        <img id="myIcon" src="gb_icon.jpg" width="150">
                    </div>
                    <div class="wSelectIcon">
                        <select id="changeIcon" onchange="changeIcon()">
                            <option value="gb_icon.jpg" selected>고양이1</option>
                            <option value="gb_icon2.jpg">고양이2</option>
                            <option value="gb_icon3.jpg">고양이3</option>
                            <option value="gb_icon4.png">고양이4</option>
                            <option value="gb_icon5.jpg">고양이5</option>
                            <option value="gb_icon6.png">고양이6</option>
                            <option value="gb_icon7.png">고양이7</option>
                        </select>
                    </div>
                </div>
                <div class="wForm2">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="wName" placeholder="이름" />
                        <label for="wName">이름</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="wPassword" placeholder="비밀번호" />
                        <label for="wPassword">비밀번호</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="wComment" placeholder="내용" />
                        <label for="wComment">응원의 한마디!</label>
                    </div>
                    <div class="wBtn">
                        <button type="button" id="btn_post" class="btn btn-primary">등록</button>
                        <button type="button" id="btn_reset" class="btn btn-primary" onclick="resetForm()">리셋</button>
                    </div>
        
                    <!--리셋 버튼 스크립트-->
                    <script>
                        function resetForm() {
                            var formControls = document.getElementsByClassName('form-control');
                            for (var i = 0; i < formControls.length; i++) {
                                formControls[i].value = "";
                            }
                        }
                    </script>
        
                </div>
            </div>
        
            <!--게시글 표시 영역-->
            <!-- <div class="posts" class="col-md-6" id="posts">
                    <div class="pIcon">
                        <img src="gb_icon.jpg" width="80" style="border:2px solid #000000;">
                    </div>
                    <div class="pContent">
                        <div class="pName" id="pName">
                            <h4>이름</h4>
                        </div>
                        <div class="pComment" id="pComment">
                            <p>방명록 내용 내용 내용</p>
                            <div class="pControl">
                                <p><span style="color:grey">작성일 2023.12.22</span></p>
                                <button type="button" data-cdid=${doc.id} class="bh_edit_btn btn btn-primary ">수정하기</button>
                                <button type="button" data-cdid=${doc.id} class="bh_del_btn btn btn-secondary">삭제하기</button>
                            </div>
                        </div>
                    </div>
                </div> -->
            <div class="postsGroup" id="postsGroup">
                <!--게시글 표시 영역-->
            </div>
        </section>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="main_nav.js"></script>

    <script type="module">
        //Firebase SDK 라이브러리 가져오기
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
        import { collection, addDoc, getDocs, getDoc, doc, updateDoc, deleteDoc, setDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDsHUgRONE099dI_cbgXTzunmAg3XGMP2k",
            authDomain: "coding-three.firebaseapp.com",
            projectId: "coding-three",
            storageBucket: "coding-three.appspot.com",
            messagingSenderId: "597951423527",
            appId: "1:597951423527:web:286f4c263055374ba81a02"
        }

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);


        //아이콘 드롭다운
        let changeimg = document.getElementById("changeIcon");
        let myImg = document.getElementById("myIcon");

        function changeIcon() {
            let index = changeimg.selectedIndex;
            myImg.src = changeimg.options[index].value;
        }

        changeIcon();
        changeimg.onchange = changeIcon;




        // 질문 1
        // 이자리에  async function deletePost(doc_id)  함수 선언 미리해두었는데도
        // 아래 onClick="deletePost()" 할 때 not defined 나오더라
        // 왜그런거임? 선언 먼저 햇는데?

        // 해결방법 
        // 버튼의 onclick 은 빼고
        // 스크립트에서 버튼 눌렀을 때  $('#btn_delete').click() 으로 바꾸니 되더라.

        // 질문2
        // 그럼 어쩌란거임;
        // 그럼 module 을 아예 안쓰고 해야되냐
        // 근데 module 쓰면 onclick 이 작동을 안하잖아


        //페이지 로드 시 방명록 포스트들 불러오기
        let readDocs = await getDocs(collection(db, 'coding-three'));
        readDocs.forEach((doc) => {  //문서 하나씩 doc 이라고 부름

            let row = doc.data();   // .data() 를 해야 우리가 값을 읽을 수 있음.

            // <- 저장
            let wName = row['이름'];
            //let wPassword = row['비밀번호'];
            let wComment = row['내용'];
            let wDate = row['작성일'];
            let wIcon = row['아이콘'];

            let temp_html = `
                <div class="posts col-md-6" id="posts">
                    <div class="pIcon">
                        <img src="${wIcon}" width="80" style="border:2px solid #000000;">
                    </div>
                    <div class="pContent">
                        <div class="pName" id="pName">
                            <h4>${row['이름']}</h4>
                        </div>
                        <div class="pComment" id="pComment">
                            <p>${wComment}</p>
                            <div class="pControl">
                                <p><span style="color:grey">${wDate}</span></p>
                                <button type="button" id="btn_edit" data-id=${doc.id} class="bh_edit_btn btn btn-primary btn_edit ">수정하기</button>
                                <button type="button" id="btn_delete" data-id=${doc.id} class="bh_del_btn btn btn-secondary btn_delete " >삭제하기</button> 
                            </div>
                        </div>
                    </div>
                </div>`;
            $('#postsGroup').prepend(temp_html);
        });


        //등록 버튼 클릭 시 파이어베이스에 아래의 데이터를 업로드
        $('#btn_post').click(async function () {
            const data = {
                wName: $('#wName').val(),
                wPassword: $('#wPassword').val(),
                wComment: $('#wComment').val(),
                wIcon: $('#changeIcon option:selected').val(),
            };

            if (!data.wName || !data.wPassword || !data.wComment) {
                alert('이름, 비밀번호, 내용을 모두 입력해주세요.');
                return;
            }

            console.log(data.wName)
            let date = new Date();
            let wDate = date.getFullYear().toString() + ". " + (date.getMonth() + 1).toString().padStart(2, '0') + ". " + date.getDate().toString().padStart(2, '0');
            let docId = date.toString().split(' ').join('');

            let my_doc = {
                '이름': data.wName,
                '비밀번호': data.wPassword,
                '내용': data.wComment,
                '작성일': wDate,
                '아이콘': data.wIcon,
            };

            await setDoc(doc(db, "coding-three", docId), my_doc);
            alert('게시글이 등록되었습니다.');

            window.location.reload();
        })

        // 이거 함수 위에  그냥 아래로 빼고 버튼 눌렀을 때 도 스크립트로 내려서 버튼엔 onclick 없앴음

        // 삭제 버튼
        async function deletePost(doc_id) {

            let targetDoc = await getDoc(doc(db, "coding-three", doc_id));

            // 가져온 문서를 데이터로 변환
            let row = targetDoc.data()

            // 그 안에 있는 .pst_pw 가져오기
            let wPassword = row.비밀번호;

            const really = prompt("작성 시 입력한 비밀번호를 입력하세요." + "");
            console.log(really)

            if (really === 'codingthree' || really == wPassword) {
                try {
                    await deleteDoc(doc(db, 'coding-three', doc_id));
                    alert('삭제되었습니다.');
                    window.location.reload();
                } catch (error) {
                    console.error('삭제 중 오류 발생:', error);
                    alert('삭제 중 오류가 발생했습니다.');
                }
            } else if (really == null) {
            } else {
                alert('비밀번호가 일치하지 않습니다.');
            }
        }

        $('.btn_delete').click(async function () {
            let doc_id = $(this).data("id");
            deletePost(doc_id)
        });

    </script>


</body>

</html>